# K8s Assistant - Kubernetes æ™ºèƒ½åŠ©æ‰‹

ä¸€ä¸ªåŸºäº RAG (Retrieval-Augmented Generation) æŠ€æœ¯çš„ Kubernetes æ™ºèƒ½é—®ç­”åŠ©æ‰‹ï¼Œèƒ½å¤ŸåŸºäºå®˜æ–¹æ–‡æ¡£ä¸ºç”¨æˆ·æä¾›å‡†ç¡®ã€ä¸“ä¸šçš„ K8s ç›¸å…³å›ç­”ã€‚

## ğŸš€ é¡¹ç›®æ¦‚è¿°

K8s Assistant æ˜¯ä¸€ä¸ªå…¨æ ˆçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œé›†æˆäº†å¤§è¯­è¨€æ¨¡å‹å’Œå‘é‡æ•°æ®åº“æŠ€æœ¯ï¼Œä¸“é—¨ä¸º Kubernetes ç”¨æˆ·æä¾›æ™ºèƒ½åŒ–çš„æ–‡æ¡£æŸ¥è¯¢å’Œé—®é¢˜è§£ç­”æœåŠ¡ã€‚

## ğŸ“‹ åŸºæœ¬åŠŸèƒ½

### 1. æ•°æ®å¤„ç†æ¨¡å—

#### æ•°æ®åŠ è½½å™¨ (`dataloader.py`)
- **åŠŸèƒ½**: è´Ÿè´£ä» HTML æ–‡æ¡£ä¸­åŠ è½½å’Œé¢„å¤„ç†æ•°æ®
- **æ ¸å¿ƒç‰¹æ€§**:
  - æ”¯æŒæ‰¹é‡å¤„ç† HTML æ–‡æ¡£
  - è‡ªåŠ¨è¿‡æ»¤æ— æ•ˆæ–‡ä»¶ï¼ˆå¦‚ `_print/index.html`ï¼‰
  - é›†æˆ Milvus å‘é‡æ•°æ®åº“
  - åˆ©ç”¨ONNXåŠ é€ŸåµŒå…¥æ¨¡å‹(BAAI/bge-small-en-v1.5, zhç‰ˆæœ¬åœ¨è½¬æ¢ONNXçš„æ—¶å€™å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥ç”¨äº†enç‰ˆ)
  - æ™ºèƒ½æ–‡æ¡£åˆ†å—å’Œå‘é‡åŒ–
  - æ”¯æŒæµå¼å¤„ç†å¤§é‡æ–‡æ¡£

#### æ•°æ®æ¸…ç†å™¨ (`data_cleaner.py`)
- **åŠŸèƒ½**: æ¸…ç†å’ŒéªŒè¯å¤„ç†åçš„æ•°æ®ï¼Œç¡®ä¿æ•°æ®è´¨é‡
- **æ ¸å¿ƒç‰¹æ€§**:
  - æ–‡æœ¬å†…å®¹æ¸…ç†å’Œæ ‡å‡†åŒ–
  - å…ƒæ•°æ®éªŒè¯å’Œä¿®å¤
  - èŠ‚ç‚¹æœ‰æ•ˆæ€§æ£€æŸ¥
  - ä»£ç å—æå–å’Œå…³è”
  - HTML å†…å®¹é¢„å¤„ç†
  - æ•°æ®ç±»å‹å®‰å…¨è½¬æ¢

#### ä»£ç æå–å™¨ (`code_extractor.py`)
- **åŠŸèƒ½**: ä» HTML æ–‡æ¡£ä¸­æ™ºèƒ½æå–ä»£ç å—
- **æ ¸å¿ƒç‰¹æ€§**:
  - ä»£ç å—ä½ç½®ä¿¡æ¯è®°å½•
  - ä»£ç å†…å®¹å®Œæ•´æ€§ä¿æŠ¤
  - ä»£ç å—ä¸æ–‡æ¡£èŠ‚ç‚¹æ™ºèƒ½å…³è”

### 2. åç«¯æœåŠ¡

#### API æœåŠ¡
- **æ¡†æ¶**: FastAPI + Uvicorn
- **æ ¸å¿ƒåŠŸèƒ½**:
  - RESTful API æ¥å£
  - æµå¼èŠå¤©å“åº”
  - å¯¹è¯å†å²ç®¡ç†
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹
  - CORS è·¨åŸŸæ”¯æŒ
  - è‡ªåŠ¨ API æ–‡æ¡£ç”Ÿæˆ

#### æ ¸å¿ƒæœåŠ¡æ¨¡å—
- **LLM æœåŠ¡** (`llm_service.py`): å¤§è¯­è¨€æ¨¡å‹é›†æˆï¼Œæ”¯æŒ OpenAI å…¼å®¹æ¥å£
- **åµŒå…¥æœåŠ¡** (`embedding_service.py`): æ–‡æœ¬å‘é‡åŒ–å¤„ç†
- **Milvus æœåŠ¡** (`milvus_service.py`): å‘é‡æ•°æ®åº“æ“ä½œ

#### æ•°æ®å¤„ç†æµç¨‹
1. **æ–‡æ¡£åŠ è½½**: ä»æŒ‡å®šç›®å½•åŠ è½½ HTML æ–‡æ¡£
2. **å†…å®¹æå–**: ä½¿ç”¨ BeautifulSoup è§£æ HTML å†…å®¹
3. **ä»£ç æå–**: æ™ºèƒ½æå–å¹¶ä¿æŠ¤ä»£ç å—
4. **æ–‡æœ¬æ¸…ç†**: ç§»é™¤æ— å…³æ ‡ç­¾ï¼Œä¿ç•™æ ¸å¿ƒå†…å®¹
5. **æ–‡æ¡£åˆ†å—**: æŒ‰é…ç½®å¤§å°åˆ†å‰²æ–‡æ¡£
6. **å‘é‡åŒ–**: ç”Ÿæˆæ–‡æ¡£åµŒå…¥å‘é‡
7. **ç´¢å¼•æ„å»º**: åœ¨ Milvus ä¸­å»ºç«‹å‘é‡ç´¢å¼•

### 3. å‰ç«¯ç•Œé¢

#### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite

#### æ ¸å¿ƒåŠŸèƒ½
- **èŠå¤©ç•Œé¢**: ç°ä»£åŒ–çš„å¯¹è¯ç•Œé¢

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Web æ¡†æ¶**: FastAPI 0.104.1
- **ASGI æœåŠ¡å™¨**: Uvicorn 0.24.0
- **å‘é‡æ•°æ®åº“**: Milvus 2.6.1 + Milvus Lite 2.5.1
- **å¤§è¯­è¨€æ¨¡å‹**: OpenAI API (å…¼å®¹æ¥å£)
- **åµŒå…¥æ¨¡å‹**: 
  - HuggingFace Transformers 4.56.1
  - Sentence Transformers 4.1.0
  - ONNX Runtime GPU 1.19.0
- **æ–‡æ¡£å¤„ç†**: 
  - BeautifulSoup4 4.13.5
  - html2text 2025.4.15
  - LlamaIndex 0.13.4

### å‰ç«¯æŠ€æœ¯
- **æ ¸å¿ƒæ¡†æ¶**: Vue 3.3.8
- **å¼€å‘è¯­è¨€**: TypeScript 5.2.0
- **æ„å»ºå·¥å…·**: Vite 5.0.0
- **è·¯ç”±ç®¡ç†**: Vue Router 4.2.5

### éƒ¨ç½²å’Œè¿ç»´
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åå‘ä»£ç†**: Nginx
- **è¿›ç¨‹ç®¡ç†**: æ”¯æŒåŸç”Ÿéƒ¨ç½²å’Œå®¹å™¨éƒ¨ç½²
- **æ—¥å¿—ç³»ç»Ÿ**: Loguru 0.7.2
- **é…ç½®ç®¡ç†**: python-dotenv 1.1.1

## ğŸ”„ ç”¨æˆ·æ¶ˆæ¯å¤„ç†æµç¨‹

å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œç³»ç»ŸæŒ‰ä»¥ä¸‹åºåˆ—å›¾è¿›è¡Œå‡½æ•°è°ƒç”¨å¤„ç†ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯ (Vue)
    participant API as åç«¯ API
    participant ES as åµŒå…¥æœåŠ¡
    participant MS as MilvusæœåŠ¡
    participant LS as LLMæœåŠ¡
    
    U->>F: è¾“å…¥é—®é¢˜
    F->>F: éªŒè¯è¾“å…¥å†…å®¹
    F->>API: POST /api/v1/chat
    Note over F,API: ChatRequest(message, context, conversation_id)
    
    API->>ES: encode(query)
    Note over ES: å°†ç”¨æˆ·æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡
    ES-->>API: query_embedding
    
    API->>MS: search_similar(embedding, top_k=5)
    Note over MS: åœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢ç›¸ä¼¼æ–‡æ¡£
    MS-->>API: similar_docs[]
    
    API->>LS: generate_rag_response(query, context_docs, history)
    Note over LS: æ„å»ºç³»ç»Ÿæç¤ºå’Œä¸Šä¸‹æ–‡
    LS->>LS: _build_system_prompt()
    LS->>LS: _build_context_text(docs)
    LS->>LS: _build_user_message(query, context)
    
    Note over LS: è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆå›å¤
    LS->>LS: generate_response(messages)
    LS->>LS: _restore_code_blocks(content, metadata)
    LS-->>API: response_content
    
    API->>API: æ„å»º ChatResponse
    Note over API: åŒ…å«å›å¤å†…å®¹ã€æ¥æºæ–‡æ¡£ã€ç›¸å…³åº¦åˆ†æ•°
    API-->>F: JSON Response
    
    F->>F: è§£æå“åº”æ•°æ®
    F->>F: æ¸²æŸ“ Markdown å†…å®¹
    F->>F: é«˜äº®ä»£ç å—
    F->>F: æ˜¾ç¤ºç›¸å…³æ–‡æ¡£æ¥æº
    F-->>U: æ˜¾ç¤ºå›å¤å†…å®¹
```

### è¯¦ç»†å¤„ç†æ­¥éª¤

1. **ç”¨æˆ·è¾“å…¥é˜¶æ®µ**
   - ç”¨æˆ·åœ¨å‰ç«¯ç•Œé¢è¾“å…¥é—®é¢˜
   - å‰ç«¯éªŒè¯è¾“å…¥å†…å®¹
   - æ„å»ºèŠå¤©è¯·æ±‚å¯¹è±¡

2. **è¯·æ±‚ä¼ è¾“é˜¶æ®µ**
   - é€šè¿‡ Axios å‘é€ POST è¯·æ±‚åˆ° `/api/v1/chat`
   - è¯·æ±‚åŒ…å«ç”¨æˆ·æ¶ˆæ¯ã€å¯¹è¯å†å²ã€é…ç½®å‚æ•°

3. **åç«¯å¤„ç†é˜¶æ®µ**
   - **æŸ¥è¯¢å‘é‡åŒ–**: ä½¿ç”¨åµŒå…¥æ¨¡å‹å°†ç”¨æˆ·æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡
   - **ç›¸ä¼¼æ€§æœç´¢**: åœ¨ Milvus å‘é‡æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ
   - **ä¸Šä¸‹æ–‡æ„å»º**: æ•´åˆæ£€ç´¢åˆ°çš„æ–‡æ¡£å’Œå¯¹è¯å†å²
   - **LLM ç”Ÿæˆ**: ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”
   - **ä»£ç æ¢å¤**: å°†æå–çš„ä»£ç å—é‡æ–°æ•´åˆåˆ°å›å¤ä¸­

4. **å“åº”è¿”å›é˜¶æ®µ**
   - æ„å»ºåŒ…å«å›å¤å†…å®¹ã€æ¥æºæ–‡æ¡£ã€ç›¸å…³åº¦åˆ†æ•°çš„å“åº”
   - è¿”å› JSON æ ¼å¼çš„èŠå¤©å“åº”
   - åŒ…å«æ¶ˆæ¯IDã€æ—¶é—´æˆ³ã€å¯¹è¯IDç­‰å…ƒä¿¡æ¯

5. **å‰ç«¯å±•ç¤ºé˜¶æ®µ**
   - æ¥æ”¶å¹¶è§£æå“åº”æ•°æ®
   - ä½¿ç”¨ Markdown æ¸²æŸ“å™¨æ ¼å¼åŒ–å†…å®¹
   - é«˜äº®æ˜¾ç¤ºä»£ç å—
   - å±•ç¤ºç›¸å…³æ–‡æ¡£æ¥æº
   - æ›´æ–°å¯¹è¯å†å²

### æµå¼å“åº”æ”¯æŒ

ç³»ç»Ÿè¿˜æ”¯æŒæµå¼å“åº”æ¨¡å¼ï¼Œä½¿ç”¨ Server-Sent Events (SSE) æŠ€æœ¯ï¼š

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯ (Vue)
    participant API as åç«¯ API
    participant ES as åµŒå…¥æœåŠ¡
    participant MS as MilvusæœåŠ¡
    participant LS as LLMæœåŠ¡
    
    U->>F: è¾“å…¥é—®é¢˜
    F->>API: POST /api/v1/chat/stream
    Note over F,API: è¯·æ±‚æµå¼å“åº”
    
    API->>ES: encode(query)
    ES-->>API: query_embedding
    
    API->>MS: search_similar(embedding, top_k=5)
    MS-->>API: similar_docs[]
    
    API->>LS: _generate_stream_response(messages)
    Note over LS: æµå¼ç”Ÿæˆå›å¤
    
    loop æµå¼è¾“å‡º
        LS-->>API: chunk_content
        API-->>F: data: chunk_content
        F->>F: å®æ—¶æ˜¾ç¤ºæ–‡æœ¬ç‰‡æ®µ
    end
    
    LS-->>API: [DONE]
    API-->>F: data: [DONE]
    F-->>U: å®Œæˆæ˜¾ç¤º
```

**æµå¼å“åº”ç‰¹ç‚¹**ï¼š
- ç”¨æˆ·å¯é€‰æ‹©æµå¼è¾“å‡ºè·å¾—å®æ—¶å“åº”
- åç«¯ä½¿ç”¨ Server-Sent Events (SSE) æŠ€æœ¯
- å‰ç«¯å®æ—¶æ¥æ”¶å’Œæ˜¾ç¤ºç”Ÿæˆçš„æ–‡æœ¬ç‰‡æ®µ
- æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯å¯¹äºé•¿å›ç­”

## ğŸ“ é¡¹ç›®ç»“æ„

```
k8sassistant/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/            # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ services/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ main.py            # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ requirements.txt   # Python ä¾èµ–
â”œâ”€â”€ frontend/              # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/          # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ components/   # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/        # é¡µé¢è§†å›¾
â”‚   â”‚   â””â”€â”€ stores/       # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ package.json      # Node.js ä¾èµ–
â”œâ”€â”€ data_processing/       # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ processors/       # æ•°æ®å¤„ç†å™¨
â”‚   â””â”€â”€ crawlers/         # æ•°æ®çˆ¬è™«
â”œâ”€â”€ docker/               # Docker é…ç½®
â”œâ”€â”€ deploy/               # éƒ¨ç½²è„šæœ¬
â””â”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+
- Docker (å¯é€‰)

### å®‰è£…å’Œè¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd k8sassistant
```

2. **åç«¯å¯åŠ¨**
```bash
cd backend
pip install -r requirements.txt
python main.py
```

3. **å‰ç«¯å¯åŠ¨**
```bash
cd frontend
npm install
npm run dev
```

4. **æ•°æ®å¤„ç†**
```bash
cd data_processing/processors
python dataloader.py --data-dir /path/to/html/docs --start-milvus
```

### é…ç½®è¯´æ˜

åˆ›å»º `.env` æ–‡ä»¶é…ç½®ç¯å¢ƒå˜é‡ï¼š
```env
# LLM é…ç½®
LLM_API_KEY=your_api_key
LLM_BASE_URL=https://api.openai.com/v1
LLM_MODEL=gpt-3.5-turbo

# åµŒå…¥æ¨¡å‹é…ç½®
EMBEDDING_MODEL=BAAI/bge-small-en-v1.5
EMBEDDING_DEVICE=cpu
EMBEDDING_BACKEND=torch

# æ•°æ®åº“é…ç½®
MILVUS_URI=http://localhost:19530
COLLECTION_NAME=k8s_docs
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

1. **æ•°æ®å‡†å¤‡**: å°† Kubernetes å®˜æ–¹æ–‡æ¡£çš„ HTML æ–‡ä»¶æ”¾å…¥æŒ‡å®šç›®å½•
2. **æ•°æ®é¢„å¤„ç†**: è¿è¡Œæ•°æ®å¤„ç†è„šæœ¬å»ºç«‹å‘é‡ç´¢å¼•
3. **å¯åŠ¨æœåŠ¡**: å¯åŠ¨åç«¯å’Œå‰ç«¯æœåŠ¡
4. **å¼€å§‹å¯¹è¯**: åœ¨ Web ç•Œé¢ä¸­è¾“å…¥ K8s ç›¸å…³é—®é¢˜
5. **æŸ¥çœ‹ç»“æœ**: ç³»ç»Ÿä¼šåŸºäºå®˜æ–¹æ–‡æ¡£æä¾›å‡†ç¡®çš„å›ç­”

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä¸“é—¨é’ˆå¯¹ Kubernetes æ–‡æ¡£è¿›è¡Œä¼˜åŒ–ï¼Œç¡®ä¿å›ç­”çš„å‡†ç¡®æ€§å’Œä¸“ä¸šæ€§ã€‚ç³»ç»Ÿä¸¥æ ¼åŸºäºæä¾›çš„æ–‡æ¡£å†…å®¹è¿›è¡Œå›ç­”ï¼Œä¸ä¼šä½¿ç”¨è®­ç»ƒæ•°æ®ä¸­çš„è¿‡æ—¶ä¿¡æ¯ã€‚
